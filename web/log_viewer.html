<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Real-Time Log Viewer</title>
    <style>
        /* === MobaXterm-like Dark Terminal Theme === */
        body {
            background-color: #1e1e1e;
            color: #cccccc;
            font-family: "Consolas", "Courier New", monospace;
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            color: #00ff87;
            font-weight: 400;
            margin-bottom: 8px;
            font-size: 18px;
            text-shadow: 0 0 6px #00ff87;
        }

        #log-box {
            background-color: #0c0c0c;
            border: 1px solid #2a2a2a;
            border-radius: 5px;
            padding: 10px;
            color: #cccccc;
            white-space: pre-wrap;
            overflow-y: auto;
            flex: 1;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: inset 0 0 15px #000;
        }

        /* Scrollbar (MobaXterm-like) */
        #log-box::-webkit-scrollbar {
            width: 10px;
        }

        #log-box::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 10px;
        }

        #log-box::-webkit-scrollbar-thumb:hover {
            background-color: #666;
        }

        /* === Log Level Colors (ANSI-like) === */
        .log-debug {
            color: #5f87ff;
            /* Blue */
        }

        .log-info {
            color: #bfbfbf;
            /* Default gray */
        }

        .log-warning {
            color: #ffd75f;
            /* Yellow-ish */
        }

        .log-error {
            color: #ff5f5f;
            /* Red */
        }

        .log-critical {
            color: #ff0000;
            font-weight: bold;
        }

        .log-success {
            color: #5fff5f;
            /* Green */
        }

        /* Cursor effect */
        #cursor {
            display: inline-block;
            width: 8px;
            background-color: #00ff87;
            animation: blink 1s step-start infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <h1>ðŸ“œ Real-Time Log Output</h1>
    <div id="log-box" style="white-space: pre-wrap; overflow-y: auto; height: 90vh;">
        {{LOG_CONTENT}}<span id="cursor"></span>
    </div>

    <script>
        const logBox = document.getElementById('log-box');
        const evtSource = new EventSource('/log_event');

        // Scroll to bottom after the initial HTML content is loaded
        window.addEventListener('load', () => {
            logBox.scrollTop = logBox.scrollHeight;
        });

        evtSource.onmessage = (e) => {
            // Remove existing cursor before appending new log line
            logBox.textContent = logBox.textContent.replace(/â–Š$/, '');
            logBox.textContent += e.data + "\n";

            // Auto-scroll to bottom on new log
            logBox.scrollTop = logBox.scrollHeight;

            // Re-add cursor
            logBox.textContent += "â–Š";
        };

        evtSource.onerror = (e) => {
            console.error("SSE connection lost.", e);
        };
    </script>
</body>

</html>